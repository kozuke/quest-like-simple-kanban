# ローカルファースト超軽量 Kanban ボード – 設計書

> **目的:** ユーザーが明示的に「保存」ボタンを押したときのみブラウザの `localStorage` に状態を保存する、シングルページ完結型のタスク管理アプリ。外部サーバーやデータベースは不要です。

---

## 1. 概要

本プロジェクトでは、オフラインでも使える 3 レーン固定のタスクボードを提供します。

| ワークフロー  | 想定用途          | デフォルトラベル |
| ------- | ------------- | -------- |
| Backlog | まだ手を付けていないタスク | **クエスト** |
| Doing   | 進行中のタスク       | **冒険中**  |
| Done    | 完了したタスク       | **クリア**  |

カードをドラッグ＆ドロップで列間移動／並び替えでき、ボードの状態から日報を生成してワンクリックでコピーできます。

## 2. 機能要件

1. **タスク登録** — タイトル必須、説明は任意。
2. **ドラッグ＆ドロップボード** — 3 列間で移動・並び替え。
3. **明示的保存** — *Save* 押下時のみ `localStorage` に永続化。
4. **日報ジェネレーター** — ステータス別にまとめたテンプレートテキストを生成。
5. **ワンクリックコピー** — 生成した日報をクリップボードへ。
6. **テンプレートエディタ** — 日報フォーマットとプレースホルダを自由編集可能。

## 3. 技術スタック

| レイヤ       | 選定技術                             | 理由                    |
| --------- | -------------------------------- | --------------------- |
| フレームワーク   | **React 18 + TypeScript (Vite)** | 高速な開発体験と型安全性。         |
| 状態管理      | **Zustand**                      | ミニマル API・永続化フックが簡単。   |
| DnD       | **dnd‑kit**                      | 近代的・アクセシビリティ配慮・ソート対応。 |
| スタイリング    | **Tailwind CSS**                 | Utility ファーストで素早く試作。  |
| アイコン      | **Lucide**                       | 軽量 SVG セット。           |
| フォント (任意) | **Press Start 2P / DotGothic16** | レトロドット風 (→ §10 参照)。   |

## 4. データモデル

```ts
export interface Task {
  id: string;          // nanoid()
  title: string;       // タスク名
  description?: string;// 説明
  createdAt: number;   // エポック ms
  status: 'backlog' | 'doing' | 'done';
}
```

グローバルストアでは `Record<string, Task>` と列ごとの並び順配列を保持し、DnD で安定した順序を保証します。

## 5. コンポーネント構成

```
<App>
 ├ Header (Save 💾 | Report 📄)
 ├ Board
 │   ├ Column Backlog  (クエスト)
 │   │   └ TaskCard*
 │   ├ Column Doing    (冒険中)
 │   │   └ TaskCard*
 │   └ Column Done     (クリア)
 │       └ TaskCard*
 └ ReportModal (textarea + Copy 📋)
```

## 6. 永続化フロー

1. **ロード** — マウント時に `localStorage.getItem('kanban-tasks')` を読み込み、存在すればストアを初期化。
2. **保存** — *Save* ボタンで `{ tasks, order }` を JSON 化し `localStorage` に書き込み。
3. **自動保存なし** — ユーザーが保存タイミングを管理。

## 7. レポートテンプレートとカスタマイズ

デフォルトの Markdown テンプレートを **TemplateEditorModal** で編集できます。Mustache 形式のプレースホルダ (`{{date}}`, `{{#backlog}}` など) に対応。

**保存場所** — `localStorage['kanban-report-template']` に格納。

**レンダリング** — `mustache.render(template, context)` を使用し、エラー時はデフォルトにフォールバック。

## 8. ディレクトリ構成

```
src/
 ├ components/
 │   Header.tsx
 │   Board.tsx
 │   Column.tsx
 │   TaskCard.tsx
 │   ReportModal.tsx
 │   TemplateEditorModal.tsx
 ├ store/
 │   useTasks.ts
 ├ utils/
 │   report.ts
 ├ assets/          // スプライト・フォント (任意)
 ├ App.tsx
 └ main.tsx
```

## 9. 実装ロードマップ

1. **プロジェクト初期化** — Vite + React‑TS, Tailwind, ESLint/Prettier。
2. **ストア実装** — CRUD アクションと並び順ヘルパ。
3. **ボード UI** — 静的 3 列と基本カード。
4. **DnD 統合** — `DndContext` と `onDragEnd`。
5. **タスク追加** — インライン入力またはモーダル。
6. **保存機能** — Load & Save ボタン実装。
7. **日報モーダル** — 生成＆クリップボードコピー。
8. **テンプレートエディタ** — ライブプレビュー・保存・リセット。
9. **ポリッシュ** — 空状態、キーボードショートカット等。
10. **テスト** — Vitest + React Testing Library。

## 10. 追加 UI テーマ ― 「ドラゴンクエスト」風 (任意)

論理機能へ影響を与えないプレゼンテーション層の提案です。

| 要素            | 推奨内容                                                                                     |
| ------------- | ---------------------------------------------------------------------------------------- |
| **列ラベル**      | Backlog/Doing/Done を **クエスト / 冒険中 / クリア** に置換し、対応絵文字 🗺 ⚔ 👑 を表示。                        |
| **カラーパレット**   | ヘッダーに *ロイヤルブルー* (`#0d41ff`)、アクセントに *ゴールド* (`#d5a100`)、背景に *スレート* (`#282b30`) でレトロ RPG 風。 |
| **フォント**      | 見出しに `Press Start 2P` または `DotGothic16` を使用し 8‑bit テイストを演出。本文は可読性重視のサンセリフ。               |
| **カードデザイン**   | 1px のピクセル枠と軽い box‑shadow でゲームメニュー感を表現。                                                   |
| **ホバー／アクティブ** | Framer Motion で小さな "バウンス" アニメを付与、スプライトの跳ねる動きを再現。                                         |
| **効果音 (任意)**  | *Save* と *Copy* 時に短いチャイム (`Audio('save-chime.mp3').play()`) を再生。設定でミュート可。                |
| **背景**        | 軽量なピクセルパターン、もしくは無地のダークスレート。過度なテクスチャは避ける。                                                 |

> **備考:** フォント・スプライト・効果音などのアセットはすべて遅延読み込みし、初回描画性能を損なわないようにします。
